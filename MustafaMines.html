<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minesweeper</title>
    <style>
        /* (Mevcut stil kodlarÄ± burada) */
    </style>
</head>
<body>

<h1>Minesweeper</h1>

<!-- Board Section -->
<div id="board" class="board"></div>

<!-- Score and Game Over / Win Message -->
<div id="message" class="message"></div>

<!-- Score, Spent, Accumulated Points -->
<div id="score" class="score">Puan: 1000</div>
<div id="spent" class="spent">GiriÅŸ iÃ§in harcanan puan: 0</div>
<div id="pointsAccumulated" class="points-accumulated">Biriken Puan: 0</div>
<div id="spendMessage" class="spend-message"></div>
<div id="errorMessage" class="error"></div> <!-- Hata mesajÄ± iÃ§in yeni bir alan -->

<!-- Settings Section (Alt KÄ±sÄ±mda) -->
<div class="settings">
    <label for="mineCount">MayÄ±n SayÄ±sÄ±nÄ± SeÃ§: </label>
    <input type="number" id="mineCount" value="5" min="1" max="24">
    <br><br>
    <label for="enterPoints">GiriÅŸ Ä°Ã§in Harcanan Puan: </label>
    <input type="number" id="enterPoints" value="100" min="1">
    <br><br>
    <button onclick="startGame()">Oyunu BaÅŸlat</button>
    <button onclick="spendPoints()">Puan Ã‡ek</button>
</div>

<script>
    const gridSize = 5; // Grid boyutu (5x5)
    let numMines = 5;  // BaÅŸlangÄ±Ã§ta 5 mayÄ±n
    let board = [];
    let revealedCount = 0;
    let score = 1000;   // BaÅŸlangÄ±Ã§ puanÄ± 1000
    let spentPoints = 0; // Harcanan puan
    let accumulatedPoints = 0; // Biriken puan
    let enteredPoints = 0; // GirdiÄŸi puan
    let gameOver = false;
    let isFirstCellClicked = false; // Ä°lk tÄ±klama kontrolÃ¼

    // Oyun durumu verilerini localStorage'a kaydet
    function saveGameState() {
        localStorage.setItem("score", score);
        localStorage.setItem("spentPoints", spentPoints);
        localStorage.setItem("accumulatedPoints", accumulatedPoints);
        localStorage.setItem("enteredPoints", enteredPoints);
        localStorage.setItem("gameOver", gameOver);
        localStorage.setItem("isFirstCellClicked", isFirstCellClicked);
        localStorage.setItem("numMines", numMines);
    }

    // Oyun durumu verilerini localStorage'tan yÃ¼kle
    function loadGameState() {
        if (localStorage.getItem("score")) {
            score = parseInt(localStorage.getItem("score"));
            spentPoints = parseInt(localStorage.getItem("spentPoints"));
            accumulatedPoints = parseInt(localStorage.getItem("accumulatedPoints"));
            enteredPoints = parseInt(localStorage.getItem("enteredPoints"));
            gameOver = JSON.parse(localStorage.getItem("gameOver"));
            isFirstCellClicked = JSON.parse(localStorage.getItem("isFirstCellClicked"));
            numMines = parseInt(localStorage.getItem("numMines"));
        }
    }

    // Oyun tahtasÄ±nÄ± oluÅŸtur
    function createBoard() {
        board = [];
        revealedCount = 0;
        gameOver = false;

        // Grid ile boÅŸ hÃ¼creler oluÅŸtur
        for (let row = 0; row < gridSize; row++) {
            let rowArray = [];
            for (let col = 0; col < gridSize; col++) {
                rowArray.push({ mine: false, revealed: false });
            }
            board.push(rowArray);
        }

        // Rastgele mayÄ±nlarÄ± yerleÅŸtir
        let minesPlaced = 0;
        while (minesPlaced < numMines) {
            let row = Math.floor(Math.random() * gridSize);
            let col = Math.floor(Math.random() * gridSize);
            if (!board[row][col].mine) {
                board[row][col].mine = true;
                minesPlaced++;
            }
        }
    }

    // HÃ¼creyi aÃ§
    function revealCell(row, col) {
        if (board[row][col].revealed || gameOver) return;

        const cell = document.getElementById(`cell-${row}-${col}`);
        board[row][col].revealed = true;
        revealedCount++;

        if (!isFirstCellClicked) {
            enteredPoints = spentPoints;  // Ä°lk tÄ±klamada girdiÄŸi puan alÄ±nÄ±r
            isFirstCellClicked = true;    // Ä°lk tÄ±klama yapÄ±ldÄ±ÄŸÄ±nda deÄŸiÅŸkeni true yap
        } else {
            enteredPoints = enteredPoints * 1.1; // Sonraki tÄ±klamalarda biriken puan ile Ã§arpÄ±lÄ±r
        }

        // MayÄ±na basÄ±ldÄ±ÄŸÄ±nda, kazanÃ§ puanÄ±nÄ± eklemeyin
        if (board[row][col].mine) {
            cell.classList.add('mine');
            const multiplierElement = document.createElement('div');
            multiplierElement.classList.add('multiplier');
            multiplierElement.textContent = `x${Math.floor(enteredPoints)}`; // Ã‡arpan deÄŸeri burada yazÄ±lacak
            cell.appendChild(multiplierElement);
            cell.textContent = 'ğŸ’£'; // MayÄ±n simgesi

            showAllMines(); // TÃ¼m mayÄ±nlarÄ± gÃ¶ster
            document.getElementById("message").textContent = `MayÄ±na bastÄ±nÄ±z! Oyun Bitti! PuanÄ±nÄ±z: ${score + accumulatedPoints}`;
            gameOver = true;
            accumulatedPoints = 0;  // MayÄ±na basÄ±nca biriken puarÄ± sÄ±fÄ±rlama
        } else {
            cell.classList.add('revealed');
            // HiÃ§bir ÅŸey gÃ¶sterme (boÅŸ hÃ¼creler)
            accumulatedPoints += enteredPoints; // Biriken puana ekle
            document.getElementById("pointsAccumulated").textContent = `Biriken Puan: ${Math.floor(accumulatedPoints)}`; // Biriken puanÄ± tam sayÄ± olarak gÃ¶ster
        }

        if (revealedCount === gridSize * gridSize - numMines) {
            document.getElementById("message").textContent = `Tebrikler, KazandÄ±nÄ±z! PuanÄ±nÄ±z: ${score + accumulatedPoints}`;
            gameOver = true;
        }

        saveGameState(); // Oyun durumu kaydedilsin
    }

    // TÃ¼m mayÄ±nlarÄ± gÃ¶ster
    function showAllMines() {
        for (let row = 0; row < gridSize; row++) {
            for (let col = 0; col < gridSize; col++) {
                const cell = document.getElementById(`cell-${row}-${col}`);
                if (board[row][col].mine && !board[row][col].revealed) {
                    cell.classList.add('mine');
                    cell.textContent = 'ğŸ’£';
                }
            }
        }
    }

    // TahtayÄ± kullanÄ±cÄ±ya gÃ¶ster
    function createBoardUI() {
        const boardElement = document.getElementById('board');
        boardElement.innerHTML = ''; // TahtayÄ± temizle

        for (let row = 0; row < gridSize; row++) {
            for (let col = 0; col < gridSize; col++) {
                const button = document.createElement('button');
                button.id = `cell-${row}-${col}`;
                button.addEventListener('click', () => revealCell(row, col));
                boardElement.appendChild(button);
            }
        }
    }

    // Oyun baÅŸlat
    function startGame() {
        if (score <= 0) {
            document.getElementById("errorMessage").textContent = 'Yeterli puanÄ±nÄ±z yok! LÃ¼tfen puanÄ±nÄ±zÄ± artÄ±rÄ±n.';
            return; // EÄŸer puan 0 veya daha dÃ¼ÅŸÃ¼kse, oyunu baÅŸlatma
        }

        const inputMineCount = document.getElementById('mineCount').value;
        const inputEnteredPoints = document.getElementById('enterPoints').value;

        numMines = Math.min(Math.max(parseInt(inputMineCount), 1), 24); // MayÄ±n sayÄ±sÄ±nÄ± 1 ile 24 arasÄ±nda sÄ±nÄ±rlayÄ±n
        enteredPoints = parseInt(inputEnteredPoints); // GiriÅŸ iÃ§in harcanan puanÄ± alÄ±n

        // MayÄ±n sayÄ±sÄ±na baÄŸlÄ± olarak harcama yapma yerine sadece girilen puan miktarÄ±nÄ± kullan
        spentPoints = enteredPoints;  // YalnÄ±zca girilen puan harcanÄ±r
        score -= spentPoints;         // Harcanan puan, kullanÄ±cÄ± puanÄ±ndan Ã§Ä±kar

        // EÄŸer puan 0'Ä±n altÄ±na dÃ¼ÅŸerse, "Para Eksik" mesajÄ± gÃ¶ster
        if (score < 0) {
            document.getElementById("errorMessage").textContent = 'Para Eksik!';
            score = 0; // Puan sÄ±fÄ±rlanÄ±r
        } else {
            document.getElementById("errorMessage").textContent = ''; // Hata mesajÄ±nÄ± sÄ±fÄ±rla
        }

        document.getElementById("score").textContent = `Puan: ${score}`;
        document.getElementById("spent").textContent = `GiriÅŸ iÃ§in harcanan puan: ${spentPoints}`;

        createBoard();  // Yeni tahtayÄ± oluÅŸtur
        createBoardUI(); // TahtayÄ± UI'ye ekle
        gameOver = false; // Oyunu yeniden baÅŸlat
        accumulatedPoints = 0; // Biriken puanlarÄ± sÄ±fÄ±rla
        document.getElementById("message").textContent = ''; // Oyun mesajÄ±nÄ± sÄ±fÄ±rla

        saveGameState(); // Oyun durumu kaydedilsin
    }

    // Puan Ã§ekme fonksiyonu
    function spendPoints() {
        if (accumulatedPoints > 0) {
            const totalPointsToAdd = Math.floor(accumulatedPoints); // Ã‡ekilen puanÄ± tam sayÄ±ya yuvarla
            score += totalPointsToAdd;
            document.getElementById("score").textContent = `Puan: ${score}`;
            document.getElementById("spent").textContent = `GiriÅŸ iÃ§in harcanan puan: 0`;
            document.getElementById("pointsAccumulated").textContent = `Biriken Puan: 0`;
            document.getElementById("spendMessage").textContent = `Puan baÅŸarÄ±yla Ã§ekildi: ${totalPointsToAdd}`;

            // TÃ¼m mayÄ±nlarÄ± gÃ¶ster
            showAllMines();

            accumulatedPoints = 0; // Biriken puanÄ± sÄ±fÄ±rla
            gameOver = true; // Oyun bitir
        } else {
            document.getElementById("spendMessage").textContent = 'HenÃ¼z biriken puan yok!';
        }

        saveGameState(); // Oyun durumu kaydedilsin
    }

    // Sayfa yÃ¼klendiÄŸinde oyun durumunu yÃ¼kle
    window.onload = function() {
        loadGameState();
        if (!gameOver) {
            createBoardUI();
            document.getElementById("score").textContent = `Puan: ${score}`;
            document.getElementById("spent").textContent = `GiriÅŸ iÃ§in harcanan puan: ${spentPoints}`;
            document.getElementById("pointsAccumulated").textContent = `Biriken Puan: ${accumulatedPoints}`;
        }
    };
</script>

</body>
</html>
